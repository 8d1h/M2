# @configure_input@
############################### targets to use
.PHONY: check all clean initialize doc book distclean justM2
################################# prologue
all ::
install ::
justM2 all :: initialize

include ../include/config.Makefile
VPATH = @srcdir@
################################# .
install :: $(docm2reldir) \
	   $(docm2reldir)/COPYING \
	   $(docm2reldir)/CHANGES \
	   $(docm2reldir)/README \
	   $(docm2reldir)/LAYOUT
$(docm2reldir):; $(INSTALL) -d "$@"
$(docm2reldir)/COPYING : COPYING ; $(INSTALL_DATA) $< "$@"
$(docm2reldir)/CHANGES : CHANGES ; $(INSTALL_DATA) $< "$@"
$(docm2reldir)/README  : README  ; $(INSTALL_DATA) $< "$@"
$(docm2reldir)/LAYOUT  : LAYOUT  ; $(INSTALL_DATA) $< "$@"
################################# srcdir
initialize :: srcdir
srcdir :; ln -s "@srcdir@" srcdir
################################# cache
initialize :: cache
cache :; mkdir $@
distclean clean ::; rm -rf cache
install :: $(cachedir)
$(cachedir):; $(INSTALL) -d "$@"
install :: $(cachedir)/Macaulay2-doc
$(cachedir)/Macaulay2-doc : cache/Macaulay2-doc; $(INSTALL_DATA) $^ "$(cachedir)"
################################# util
initialize::; $(MAKE) -C util all
distclean clean ::; $(MAKE) DEPENDS=no -C util $@
################################# html-check-links
initialize::; $(MAKE) -C html-check-links all
distclean clean ::; $(MAKE) DEPENDS=no -C html-check-links $@
################################# c
distclean clean ::; $(MAKE) DEPENDS=no -C c $@
all justM2 ::; $(MAKE) -C c all
################################# e
justM2 ::; $(MAKE) -C e all
all check ::; $(MAKE) -C e $@
initialize distclean clean ::; $(MAKE) DEPENDS=no -C e $@
################################# dumpdata
ifeq "$(DUMPDATA)" "yes"
justM2 ::; $(MAKE) -C dumpdata all
all check ::; $(MAKE) -C dumpdata $@
endif
distclean clean ::; $(MAKE) DEPENDS=no -C dumpdata $@
################################# compat
all clean distclean ::; $(MAKE) -C compat $@
################################# d
initialize ::; $(MAKE) DEPENDS=no -C d compat.h
justM2 all ::; util/restart d/restart.tmp $(MAKE) -C d all
distclean clean ::; $(MAKE) DEPENDS=no -C d $@
################################# basictests
check ::; $(MAKE) -C basictests -k
distclean clean ::; $(MAKE) -C basictests $@
################################# tutorial
#### keep this before 'm2' so the final/*.out files get made
justM2::; $(MAKE) -C tutorial all
install all distclean clean::; $(MAKE) -C tutorial $@
################################# m2
install distclean clean check justM2 all ::; $(MAKE) -C m2 $@
################################# test
check ::; $(MAKE) -C test -k
distclean clean ::; $(MAKE) -C test $@
################################# setup
all :: setup
	[ -x $< ] || chmod a+x $<
install ::; $(INSTALL_PROGRAM) setup $(libm2dir)
distclean ::; rm -f setup
################################# packages
# from now on, all packages will be separate entities
# all install check clean distclean ::; $(MAKE) -C packages $@
################################# images
doc :: images
install distclean clean ::; $(MAKE) -C images $@
################################# book
# doc :: book
book ::;  $(MAKE) -C book all
distclean clean ::; $(MAKE) -C book $@
################################# emacs
all ::;  $(MAKE) -C emacs all
install distclean clean ::; $(MAKE) -C emacs $@
################################# bin
bin :; mkdir $@
clean ::; rm -rf bin
initialize :: bin
install :: $(bindir)/Macaulay2$(EXE)
$(bindir)/Macaulay2 : bin/Macaulay2$(EXE); $(INSTALL_PROGRAM) $^ $(bindir)/Macaulay2$(EXE)
################################# cache
ifeq "$(DUMPDATA)" "yes"
ifeq "$(encap)" "no"
install :: $(cachedir)/$(DUMPDATAFILE)
$(cachedir)/$(DUMPDATAFILE) : $(DUMPDATAFILE); $(INSTALL) $< "$@"
endif
endif
################################# Makefile
Makefile : Makefile.in
	cd ..; ./config.status Macaulay2/Makefile
distclean::; rm -f Makefile
################################# final status messages
justM2 all doc clean distclean::
	@echo "-------- done making '$@' --------"

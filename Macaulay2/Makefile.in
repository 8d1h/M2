# @configure_input@
############################### targets to use
.PHONY: check all clean initialize doc book distclean justM2
################################# prologue
all ::
install ::
justM2 all :: initialize

include ../include/config.Makefile
VPATH = @srcdir@
################################# .
install install-others install-Macaulay2 :: @encapdir@/$(docm2RelDir) $(docm2dir) \
	   $(docm2dir)/COPYING \
	   $(docm2dir)/README \
	   @encapdir@/$(docm2RelDir)/CHANGES \
	   $(docm2dir)/LAYOUT

$(docm2dir) @encapdir@/$(docm2RelDir):; @MKDIR_P@ "$@"
$(docm2dir)/COPYING : COPYING ; @INSTALL_DATA@ $< "$@"
@encapdir@/$(docm2RelDir)/CHANGES : CHANGES ; @INSTALL_DATA@ $< "$@"
$(docm2dir)/LAYOUT  : LAYOUT  ; @INSTALL_DATA@ $< "$@"
$(docm2dir)/README  : README  ; @INSTALL_DATA@ $< "$@"

# install install-others install-Macaulay2 :: @encapdir@/$(docm2RelDir)/INSTALL
# @encapdir@/INSTALL  : INSTALL  ; @INSTALL_DATA@ $< "$@"

################################# srcdir
initialize :: srcdir
srcdir :; echo "@srcdir@" >$@
clean::; rm -f srcdir
################################# cache
initialize :: cache
cache :; mkdir $@
distclean clean ::; rm -rf cache
install install install-others install-Macaulay2 :: @encapdir@/$(cacheRelDir)
@encapdir@/$(cacheRelDir):; @INSTALL@ -d "$@"
################################# util
initialize::; $(MAKE) -C util all
distclean clean ::; $(MAKE) DEPENDS=no -C util $@
################################# html-check-links
#initialize::; $(MAKE) -C html-check-links all
distclean clean ::; $(MAKE) DEPENDS=no -C html-check-links $@
################################# c
distclean clean ::; $(MAKE) DEPENDS=no -C c $@
all justM2 ::; $(MAKE) -C c all
################################# e
all check justM2 initialize ::; $(MAKE) -C e DEPENDS=no initialize
justM2 ::; $(MAKE) -C e all
all ::; $(MAKE) -C e $@

# check ::; $(MAKE) -C e $@
check ::
	@ echo "---###################################----"
	@ echo "---#### disabled: make -C e check ####----"
	@ echo "---###################################----"

initialize distclean clean ::; $(MAKE) DEPENDS=no -C e $@
################################# dumpdata
ifeq "@DUMPDATA@" "yes"
justM2 ::; $(MAKE) -C dumpdata all
install all check ::; $(MAKE) -C dumpdata $@
install-others install-Macaulay2 ::; $(MAKE) -C dumpdata "install"
endif
distclean clean ::; $(MAKE) DEPENDS=no -C dumpdata $@
################################# compat
all clean distclean ::; $(MAKE) -C compat $@
################################# regex
all ::; $(MAKE) -C regex $@
clean distclean ::; $(MAKE) DEPENDS=no -C regex $@
################################# d
initialize ::; $(MAKE) DEPENDS=no -C d compat.h
### util/restart and util/update cooperate here:
justM2 all ::; util/restart d/restart.tmp $(MAKE) -C d all
distclean clean ::; $(MAKE) DEPENDS=no -C d $@
################################# bin
install distclean clean ::; $(MAKE) -C bin $@
install-others install-Macaulay2 ::; $(MAKE) -C bin "install"
################################# basictests
check ::; $(MAKE) -C packages/Macaulay2/basictests -k
distclean clean ::; $(MAKE) -C packages/Macaulay2/basictests $@
################################# m2
install distclean clean check justM2 all ::; $(MAKE) -C m2 $@
install-others install-Macaulay2 ::; $(MAKE) -C m2 "install"
################################# test
check ::; $(MAKE) -C packages/Macaulay2/test -k
distclean clean ::; $(MAKE) -C packages/Macaulay2/test $@
################################# packages
all check install install-others install-Macaulay2 clean distclean ::; $(MAKE) -C packages $@
################################# probe
clean distclean ::; $(MAKE) -C probe $@
################################# book
# doc :: book
book ::;  $(MAKE) -C book all
distclean clean ::; $(MAKE) -C book $@
################################# emacs
all ::;  $(MAKE) -C emacs all
install distclean clean ::; $(MAKE) -C emacs $@
install-others install-Macaulay2  ::;  $(MAKE) -C emacs "install"
################################# man
all install :: ; $(MAKE) -C man $@
install-others install-Macaulay2 :: ; $(MAKE) -C man "install"
################################# Makefile
Makefile : Makefile.in
	cd ..; ./config.status Macaulay2/Makefile
distclean::; rm -f Makefile
################################# final status messages
justM2 all doc clean distclean::
	@echo "-------- done making '$@' --------"
#################################
clean :: ; rm -f gmon.out

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/Macaulay2 "
# End:

# @configure_input@
include ../../include/config.Makefile
.LIBPATTERNS = lib%.a
vpath %.a  $(BUILTLIBPATH)/lib
vpath %.so $(BUILTLIBPATH)/lib
VPATH = @srcdir@
EXES := echoout timestmp restart updat
CPPFLAGS :=  -I. -I../../include $(CPPFLAGS)

ifeq (@OS@,Linux)
EXES += screen
endif

.PHONY : stage1 clean distclean

stage1:: $(EXES)

# overlay.h is no longer needed
#  stage1:: overlay.h
#  overlay.h : overlay ; ./$< >$@

# stage1 :: targettypes.h
#  we don't need targettypes.h any more
#  it's replaced by stdint.h
#  and it makes cross-compiling not work
# targettypes.h : targettypes ; ./$^ >$@

clean ::; rm -f overlay.h overlay gmon.out
updat.o : restart.h
clean ::; rm -f $(EXES) *.o $(EXES:=.exe) $(EXES:=.obj) targettypes.h
../bin/linkexec : linkexec ; cp -a $< $@

ifeq "@OS@" "Windows-95-98-NT"
stage1:: ../setup.exe
../setup.exe : setup
	cp setup.exe ..
endif

distclean : clean
	rm -f Makefile

Makefile : Makefile.in; cd ../..; ./config.status Macaulay2/util/Makefile

# gc_test
CPPFLAGS += -I@srcdir@/../../include
LDLIBS += -lgc
ifeq "@PTHREADS@" "yes"
LDLIBS += -lpthread
endif

stage1 :: gc_tested
gc_test : gc_test.c -lgc
gc_tested: gc_test; ./$<; touch $@
clean ::; rm -f gc_tested gc_test

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/Macaulay2/util "
# End:

# @configure_input@
include ../../../include/config.Makefile
srcdir = $(shell cd @srcdir@; pwd)
CHAPTERS = completeIntersections \
	   constructions \
	   d-modules \
	   exterior-algebra \
	   geometry \
	   monomialIdeals \
	   preface \
	   programming \
	   schemes \
	   solving \
	   toricHilbertScheme \
	   varieties

Makefile : @srcdir@/Makefile.in
	cd ../../..; ./config.status Macaulay2/packages/ComputationsBook/Makefile
distclean:; rm -f Makefile

.PHONY: clean changes distclean all check

ifneq "@srcdir@" "."
check :: $(CHAPTERS)
$(CHAPTERS):; mkdir "$@"
endif

check :: $(patsubst %, %/Makefile, $(CHAPTERS))
$(patsubst %, %/Makefile, $(CHAPTERS)): @srcdir@/Makefile.chapter; cp $< $@

check ::
	for d in $(CHAPTERS) ; \
	   do $(MAKE) -C $$d srcdir=$(srcdir)/$$d || exit 1; \
	   done

changes:
	-for i in $(CHAPTERS); \
	do diff -u @srcdir@/$$i/chapter.m2 @srcdir@/$$i/test.m2 ;\
	   diff -u @srcdir@/$$i/chapter.out.expected @srcdir@/$$i/test.out.expected ;\
	done

clean::
	rm -f */*.trim */Makefile */*.out programming/foo


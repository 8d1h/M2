# @configure_input@
include ../../include/config.Makefile
VPATH = @srcdir@

## here is the list of those package files to install with Macaulay2
PACKAGES = Macaulay2
PACKAGES += Style
PACKAGES += Classic
PACKAGES += Parsing
PACKAGES += Classic
PACKAGES += PrimaryDecomposition
PACKAGES += CacheFileName
#PACKAGES += ConvexHulls
PACKAGES += FourierMotzkin
PACKAGES += Dmodules
PACKAGES += Elimination
PACKAGES += FirstPackage
PACKAGES += GenericInitialIdeal
PACKAGES += Markov
PACKAGES += minimal
PACKAGES += Points
PACKAGES += PackageTemplate
PACKAGES += SimplicialComplexes
PACKAGES += LLLBases

# PACKAGES += SchurRings
##

RemakeAllDocumentation ?= false
IgnoreExampleErrors ?= false
CheckDocumentation ?= true

# we'll leave this on until we get the documentation fixed!
IgnoreDocumentationErrors ?= true

RerunExamples ?= false
debugLevel ?= 0

ARGS := , MakeLinks => false
ARGS += , RerunExamples => $(RerunExamples)
ARGS += , IgnoreExampleErrors => $(IgnoreExampleErrors)
ARGS += , IgnoreDocumentationErrors => $(IgnoreDocumentationErrors)
ARGS += , RemakeAllDocumentation => $(RemakeAllDocumentation)
ARGS += , CheckDocumentation => $(CheckDocumentation)
ARGS += , MakeInfo => true
ARGS += , UserMode => false
ARGS += , DebuggingMode => false

ifeq ($(ENCAP),yes)
Encapsulate = true
else
Encapsulate = false
endif

ARGS1 := $(ARGS), PackagePrefix => \"$(prefix)/\", Encapsulate => $(Encapsulate)
ARGS2 := $(ARGS), PackagePrefix => \"$(encapdir)/\", Encapsulate => false

check ::
	@ for i in $(PACKAGES) ; \
	  do ( \
	     set -x ; \
		  ../bin/M2$(EXE) -q --stop \
		    --prefix $(encapdir) \
		    -e "needsPackage(\"$$i\",MakeDocumentation=>true); check $$i; exit 0" ; \
	     ) ; \
	  done

install ::
	@ for i in $(PACKAGES) ; \
	  do ( \
	      if [ "$$i" = Macaulay2 ] ; \
	      then \
		  set -x ; \
		  ../bin/M2$(EXE) -q --stop \
		    --prefix $(encapdir) \
		    -e errorDepth=0 \
		    -e debugLevel=$(debugLevel) \
		    -e "installPackage(\"$$i\" $(ARGS1))" \
		    -e "exit 0" ; \
	      else \
		  set -x ; \
		  ../bin/M2$(EXE) -q --stop \
		    --prefix $(encapdir) \
		    -e errorDepth=0 \
		    -e debugLevel=$(debugLevel) \
		    -e "installPackage(\"$$i\" $(ARGS2))" \
		    -e "exit 0" ; \
	      fi ; \
	     ) || exit 1 ; \
	done

clean::; rm -rf tmp *.installed

Dmodules.installed :: @srcdir@/Dmodules/*.m2

# ./tmp is used by examples in CacheFileName.m2
CacheFileName.installed : tmp
tmp : ; mkdir tmp

distclean::clean
clean check distclean ::; $(MAKE) -C ComputationsBook $@
Makefile: Makefile.in; cd ../..; ./config.status Macaulay2/packages/Makefile
distclean::; rm -f Makefile

## here is the list of other files to install along with Macaulay2
install :: $(packagesdir)/eliminate.m2
$(packagesdir)/eliminate.m2 : eliminate.m2 ; cp $^ "$@"

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/Macaulay2/packages "
# End:

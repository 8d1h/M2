# @configure_input@
include ../../include/config.Makefile
VPATH = @srcdir@

## here is the list of those package files to install with Macaulay2
PACKAGES = M2doc
PACKAGES += CacheFileName
PACKAGES += ConvexHulls
PACKAGES += Dmodules
PACKAGES += Elimination
PACKAGES += FirstPackage
PACKAGES += GenericInitialIdeal
PACKAGES += Markov
PACKAGES += PrimaryDecomposition
PACKAGES += minimal
# PACKAGES += SchurRings
##

TMPPREFIX = tmp-packages

ARGS :=
ARGS += -q
ARGS += --stop
ARGS += --prefix $(TMPPREFIX)
ARGS += -e errorDepth=0
ARGS += -e "installPackage(\"$*\", Encapsulate => false, RemakeAllDocumentation => true, MakeInfo => true, PackagePrefix => \"./$(TMPPREFIX)/\")"
ARGS += -e "exit 0"

%.installed : %.m2
	../bin/M2 $(ARGS)
	touch "$@"

all :: $(PACKAGES:=.installed)

clean::; rm -rf tmp $(TMPPREFIX) *.installed
install: all; tar cf - -C $(TMPPREFIX) . | tar xfp - -C $(encapdir)

Dmodules.installed :: @srcdir@/Dmodules/*.m2

# ./tmp is used by examples in CacheFileName.m2
CacheFileName.installed : tmp
tmp : ; mkdir tmp

clean check distclean ::; $(MAKE) -C ComputationsBook $@
Makefile: Makefile.in; cd ../..; ./config.status Macaulay2/packages/Makefile
distclean::clean
distclean::; rm -f Makefile

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/Macaulay2/packages "
# End:

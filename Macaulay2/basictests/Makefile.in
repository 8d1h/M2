# @configure_input@
include ../../include/config.Makefile
VPATH = @srcdir@

# export LD_LIBRARY_PATH=../lib

TESTRESULTS := $(notdir $(patsubst %.m2, %.okay, $(wildcard @srcdir@/*.m2)))

.PHONY : all clean distclean install check default

all check:: $(TESTRESULTS)
distclean :: clean

$(TESTRESULTS) : ../bin/M2

ARGS := --silent --stop --no-loaddata --no-setup -e 'srcdir = "@srcdir@/"'

%.okay : %.m2
	@ echo testing $<
	@ env ../bin/M2 $(ARGS) $< -e 'exit 0'
	@ touch $@

clean::	; rm -f *.okay
LOADLIBES += -lgc
all:: testgc; ./testgc
clean:: ; rm -f testgc
Makefile : Makefile.in ; cd ../.. && ./config.status Macaulay2/basictests/Makefile
distclean ::; rm -f Makefile
check :: check-return-code
check-return-code :; if echo 'error "foo"' | ../bin/M2 $(ARGS) ; then false ; else true ; fi

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/Macaulay2/basictests "
# End:

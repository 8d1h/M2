# @configure_input@
include ../../include/config.Makefile
VPATH = @srcdir@
RESULTS := $(notdir $(patsubst %.m2, %.okay, $(wildcard @srcdir@/*.m2))) $(notdir $(patsubst %.m2-input, %.okay, $(wildcard @srcdir@/*.m2-input)))
ifneq "$(DUMPDATA)" "no"
RESULTS := $(RESULTS) dumpdata.okay
endif

LATERESULTS := missingDoc.okay

all check :: ; $(MAKE) -C engine $@
all check :: $(RESULTS)

$(RESULTS) : ../bin/M2
$(LATERESULTS) : ../bin/M2 ../cache/Macaulay2-doc ../cache/Macaulay2-made

ARGS := --silent --stop -q -e 'path=join(path,{"@srcdir@/","@srcdir@/../packages/"})'

# uncomment this for further debugging:
# ARGS += -e 'errorDepth = 0'

%.okay : %.m2
	@ echo testing $<
	@ ulimit -t 600; time ../bin/M2 $(ARGS) $< -e 'exit(0)'
	@ touch $@

# this version redirects the input (some bugs are detectable only this way
%.okay : %.m2-input
	@ echo testing $<
	@ ulimit -t 600; time ../bin/M2 $(ARGS) <$< >$*.out
	@ touch $@

clean::; rm -f *.okay *.out core
distclean:: clean; rm -f Makefile
clean distclean::; $(MAKE) -C engine $@
docStructure.out : docStructure.m2
Makefile : Makefile.in; cd ../..; ./config.status Macaulay2/test/Makefile

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/Macaulay2/test"
# End:

# @configure_input@
include ../include/config.Makefile
VPATH = @srcdir@
DEPENDS = yes
############################## main targets
all :: $(PKG_DEB) tidy
#################################
# notice that fakeroot is required, get it here: http://ftp.debian.org/debian/pool/main/f/fakeroot
$(PKG_DEB) : debian-binary control.tar.gz data.tar.gz
	rm -f $@
	ar r $@ $^
CONTROLFILES := control
# CONTROLFILES += md5sums
# CONTROLFILES += preinst
CONTROLFILES += postinst
CONTROLFILES += prerm
# CONTROLFILES += postrm
control.tar.gz : $(CONTROLFILES)
	chmod a+x prerm preinst postrm postinst
	fakeroot chown root $(CONTROLFILES)
	fakeroot tar cfz $@ $^
prepare : ../$(PKG_TGZ)
	rm -rf $(package) usr
	tar xzfp $^
	for i in $(package)/* ; do if [ -f "$$i" ] ; then rm "$$i" ; fi ; done
	mv $(package) usr
	fakeroot chown -R root usr
data.tar.gz : prepare
	fakeroot tar cfz $@ usr
md5sums : prepare
	find usr -type f | xargs md5sum > $@
tidy :
	rm -rf usr control.tar.gz data.tar.gz md5sums
clean ::
	rm -rf $(package) usr debian-binary control.tar.gz data.tar.gz md5sums 
	rm -rf $(PKG_DEB)
distclean : clean; rm -f Makefile control

Makefile : Makefile.in; cd ..; ./config.status debian/Makefile
control : control.in; cd ..; ./config.status debian/control
prerm : prerm.in; cd ..; ./config.status debian/prerm
preinst : preinst.in; cd ..; ./config.status debian/preinst
postrm : postrm.in; cd ..; ./config.status debian/postrm
postinst : postinst.in; cd ..; ./config.status debian/postinst

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/debian "
# End:

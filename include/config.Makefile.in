# @configure_input@

# every makefile that includes this one should use 'all' as the
# default (first) target
all::

# cygwin 'make' might get confused by setting SHELL
# SHELL = @SHELL@

.DELETE_ON_ERROR :

PACKAGE_NAME = @PACKAGE_NAME@
PACKAGE_TARNAME = @PACKAGE_TARNAME@
PACKAGE_VERSION = @PACKAGE_VERSION@
M2_PACKAGE_NAME = undefined
package = Macaulay2-$(PACKAGE_VERSION)
ARCH    = @ARCH@
OS      = @OS@
REL     = @REL@

DESC    = @PACKAGE_VERSION@-@host_cpu@-@OS@-@REL@
# we used to use @ ARCH @ instead of @ host_cpu @ here, but for DEC alphas,
# and perhaps other machines, it gives more information.  The script
# config.guess assembles host_cpu from /proc/cpuinfo, and can be something
# like "alphaev6" or "alphaev56", but ARCH, which is determined from 'uname'
# by the 'configure' script, will be simply "alpha".

DUMPDATA = @DUMPDATA@
NODENAME = @NODENAME@
PROFILE = @PROFILE@
STRIP = @STRIP@
OPTIMIZE = @OPTIMIZE@
DEBUG = @DEBUG@
MEMDEBUG = @MEMDEBUG@
VERBOSE = @VERBOSE@
STATIC = @STATIC@
GC_FOR_NEW = @GC_FOR_NEW@

CC = @CC@
GCC = @GCC@
CXX = @CXX@
YACC = @YACC@
AWK = @AWK@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@
CFLAGS = @CFLAGS@
CPPFLAGS = @CPPFLAGS@
CXXFLAGS = @CXXFLAGS@
FFLAGS = @FFLAGS@
DEFS = @DEFS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@

# Macaulay 2 file system layout definitions :
#  see http://www.pathname.com/fhs/
#      http://fink.sourceforge.net/doc/packaging/fslayout.php
#      http://cr.yp.to/unix.html, the section on "Filesystem layout"

# prologue

prefix = @prefix@
encapdir = @encapdir@
encap = @encap@
ifeq "$(encap)" "yes"
target = $(encapdir)/$(package)
else
target = $(prefix)
endif

# common layout

bindir = $(target)/bin
libdir = $(target)/lib
datadir = $(target)/share
mandir = $(datadir)/man
man1dir = $(mandir)/man1
man3dir = $(mandir)/man3
emacsdir = $(datadir)/emacs/site-lisp
docdir = $(datadir)/doc
docm2dir = $(docdir)/Macaulay2

# packages layout

packagesdir = $(datadir)/Macaulay2/packages
docpackagesdir = $(docm2dir)/packages
packagesrcdir = $(packagesdir)/$(M2_PACKAGE_NAME)
packagedocdir = $(docpackagesdir)/$(M2_PACKAGE_NAME)
packageimagesdir = $(packagedocdir)/images
packagehtmldir = $(packagedocdir)/html

# M2 layout

libm2dir = $(libdir)/Macaulay2/$(PACKAGE_VERSION)
cachedir = $(libm2dir)/cache
libexecdir = $(libm2dir)/libexec

datam2dir = $(datadir)/Macaulay2/
sharedir = $(datam2dir)/$(PACKAGE_VERSION)
m2dir = $(sharedir)/m2

docm2reldir = $(docm2dir)/$(PACKAGE_VERSION)
emacsdocdir = $(docm2reldir)/emacs
htmldocdir = $(docm2reldir)/html
imagesdir = $(docm2reldir)/images

# end file system layout

RANLIB = @RANLIB@
AR = ar

MAKEFLAGS += -w

ifdef CYGWIN32
# CFLAGS += '-Dabort()=exit(1)'
# CXXFLAGS += '-Dabort()=exit(1)'
# this approach to fixing "abort" doesn't work because of a slight
# bug in configure/makeconf - strings here get evaluated by the
# shell a different number of times between now and
#   (1) the evaluation of the test compilations in factory/configure
#   (2) the evaluation of the compilations in factory/GNUmakefile
# and thus it is impossible to shield the parentheses from the shell.
# A fix is for all expressions in factory/configure like 
#	eval $ac_compile
# to be replaced by expressions like
#	eval `eval "echo $ac_compile"`
endif

ifeq "$(OS) $(ARCH)" "Linux alpha"
AS = gcc -c -x assembler-with-cpp
endif

ifeq "$(CC)" "cl"
include config.Microsoft
endif

DEBUGFLAGS :=

ifeq "$(DEBUG)" "yes"
DEBUGFLAGS += -DDEBUG
else
DEBUGFLAGS += -DNDEBUG
endif

ifeq "$(PROFILE)" "yes"
CFLAGS   += -pg
CXXFLAGS += -pg
LDFLAGS  += -pg
STRIP := no
endif

ifeq "$(GCC)" "yes"
CFLAGS   += -Wall -Wshadow -Wcast-qual
CXXFLAGS += -Wall -Wshadow -Wcast-qual
ifeq "$(OPTIMIZE)" "yes"
CFLAGS   += -O3 -fexpensive-optimizations
CXXFLAGS += -O3 -fexpensive-optimizations
else
CFLAGS   += -O0
CXXFLAGS += -O0
endif
endif

ifeq "$(STRIP)" "no"
STRIPCMD := :
else
ifneq "$(CC)" "cl"
# -fomit-frame-pointer causes strange bugs!
# CFLAGS   += -fomit-frame-pointer
# CXXFLAGS += -fomit-frame-pointer
LDFLAGS  += -s
STRIPCMD := strip
endif
endif

ifeq "$(OS)" "CYGWIN_NT-5.0"
EXE := .exe
else
EXE :=
endif

ifeq "$(MEMDEBUG)" "yes"
DEBUGFLAGS += -DMEM_DEBUG
endif

DUMPDATAFILE := libexec/Macaulay2-$(ARCH)-data

ifneq "$(prefix)" "/usr"
CPPFLAGS += -I$(prefix)/include
LOADLIBES += -L$(prefix)/lib
endif

# Local Variables:
# compile-command: "make -f Makefile-configuration"
# End:

# @configure_input@

# every makefile that includes this one should use 'all' as the
# default (first) target
all::

# cygwin 'make' might get confused by setting SHELL
# SHELL = @SHELL@

PACKAGE_NAME = @PACKAGE_NAME@
PACKAGE_VERSION = @PACKAGE_VERSION@
ARCH    = @ARCH@
OS      = @OS@
REL     = @REL@

DESC    = @PACKAGE_VERSION@-@host_cpu@-@OS@-@REL@
# we used to use @ARCH@ instead of @host_cpu@ here, but for DEC alphas,
# and perhaps other machines, it gives more information.  The script
# config.guess assembles host_cpu from /proc/cpuinfo, and can be something
# like "alphaev6" or "alphaev56", but ARCH, which is determined from 'uname'
# by the 'configure' script, will be simply "alpha".

DUMPDATA = @DUMPDATA@
NODENAME = @NODENAME@
PROFILE = @PROFILE@
STRIP = @STRIP@
OPTIMIZE = @OPTIMIZE@
DEBUG = @DEBUG@
MEMDEBUG = @MEMDEBUG@
VERBOSE = @VERBOSE@
STATIC = @STATIC@
GC_FOR_NEW = @GC_FOR_NEW@

CC = @CC@
GCC = @GCC@
CXX = @CXX@
YACC = @YACC@
AWK = @AWK@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@
CFLAGS = @CFLAGS@
CPPFLAGS = @CPPFLAGS@
CXXFLAGS = @CXXFLAGS@
FFLAGS = @FFLAGS@
DEFS = @DEFS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
prefix = @prefix@
encap = @encap@
encapdir = @encapdir@
package = Macaulay2-$(PACKAGE_VERSION)

ifeq "$(encap)" "yes"
target = $(encapdir)/$(package)
else
target = $(prefix)
endif

packagedir = $(target)/lib/$(package)
bindir = $(target)/bin

RANLIB = @RANLIB@
AR = ar

MAKEFLAGS += -w

ifdef CYGWIN32
# CFLAGS += '-Dabort()=exit(1)'
# CXXFLAGS += '-Dabort()=exit(1)'
# this approach to fixing "abort" doesn't work because of a slight
# bug in configure/makeconf - strings here get evaluated by the
# shell a different number of times between now and
#   (1) the evaluation of the test compilations in factory/configure
#   (2) the evaluation of the compilations in factory/GNUmakefile
# and thus it is impossible to shield the parentheses from the shell.
# A fix is for all expressions in factory/configure like 
#	eval $ac_compile
# to be replaced by expressions like
#	eval `eval "echo $ac_compile"`
endif

ifeq "$(OS) $(ARCH)" "Linux alpha"
AS = gcc -c -x assembler-with-cpp
endif

ifeq "$(CC)" "cl"
include config.Microsoft
endif

DEBUGFLAGS :=

ifeq "$(DEBUG)" "yes"
DEBUGFLAGS += -DDEBUG
else
DEBUGFLAGS += -DNDEBUG
endif

ifeq "$(PROFILE)" "yes"
CFLAGS   += -pg
CXXFLAGS += -pg
LDFLAGS  += -pg
STRIP := no
endif

ifeq "$(GCC)" "yes"
CFLAGS   += -Wall -Wshadow -Wcast-qual
CXXFLAGS += -Wall -Wshadow -Wcast-qual
ifeq "$(OPTIMIZE)" "yes"
CFLAGS   += -O3 -fexpensive-optimizations
CXXFLAGS += -O3 -fexpensive-optimizations
else
CFLAGS   += -O0
CXXFLAGS += -O0
endif
endif

ifeq "$(STRIP)" "no"
STRIPCMD := :
else
ifneq "$(CC)" "cl"
# -fomit-frame-pointer causes strange bugs!
# CFLAGS   += -fomit-frame-pointer
# CXXFLAGS += -fomit-frame-pointer
LDFLAGS  += -s
STRIPCMD := strip
endif
endif

ifeq "$(MEMDEBUG)" "yes"
DEBUGFLAGS += -DMEM_DEBUG
endif

ifneq "$(DUMPDATA)" "no"
DUMPDATAFILE := libexec/Macaulay2-$(ARCH)-data
endif

CPPFLAGS += -I$(prefix)/include

# Local Variables:
# compile-command: "make -f Makefile-configuration"
# End:

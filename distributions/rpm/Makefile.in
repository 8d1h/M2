# @configure_input@
include ../../include/config.Makefile
CHOWN = chown
TIDY = yes
VPATH = @srcdir@
DEPENDS = yes
include ../Makefile.filenames

# notice that fakeroot is required, get it here: http://ftp.debian.org/debian/pool/main/f/fakeroot

# commands for testing the rpm file:
#  install:
#    rpm -i -v --nodeps *.rpm
#  remove:
#	Version: 0.9.95
#	Release: 2
#    rpm -e -v --noscripts Macaulay2-0.9.95-2

############################## main targets
all install :: warning
all install :: ../../@PKG_RPM@ ../../@PKG_COM_RPM@
ifeq ($(TIDY),yes)
all install :: tidy
endif
always :
warning: always
ifeq (@FAKEROOT@,)
	@echo "============================================================================="
	@echo "Warning: 'fakeroot' not installed (at configuration time), so"
	@echo "  either run this as root, or use 'make CHOWN=:' to bypass ownership setting."
	@echo "============================================================================="
endif
SEDOPTS = -e 's=^\.="=' -e 's=$$="='
../../@PKG_RPM@ : Macaulay2-body.spec ../../$(PKG_TZ) Makefile
	rm -rf files
	umask 022 ; @MKDIR_P@ files@FINALPREFIX@
	umask 022 ; @FAKEROOT@ tar xfp ../../$(PKG_TZ)     @TAR_COMPRESS_OPTION@ -C files@FINALPREFIX@
	mv files@FINALPREFIX@/@package@/* files@FINALPREFIX@
	rmdir files@FINALPREFIX@/@package@
	cd files@FINALPREFIX@ && rm -f INSTALL encapinfo postinstall preremove
	cat Macaulay2-body.spec >Macaulay2.spec
	(cd files && find . -type d -o -type f -o -type l) | sed $(SEDOPTS) >>Macaulay2.spec
	@FAKEROOT@ rpmbuild -bb Macaulay2.spec
../../@PKG_COM_RPM@ : Macaulay2-common-body.spec ../../$(PKG_COM_TZ) Makefile
	rm -rf files-common
	umask 022 ; @MKDIR_P@ files-common@FINALPREFIX@
	umask 022 ; @FAKEROOT@ tar xfp ../../$(PKG_COM_TZ) @TAR_COMPRESS_OPTION@ -C files-common@FINALPREFIX@
	mv files-common@FINALPREFIX@/@package@/* files-common@FINALPREFIX@
	rmdir files-common@FINALPREFIX@/@package@
	cd files-common@FINALPREFIX@ && rm -f INSTALL encapinfo postinstall preremove
	cat Macaulay2-common-body.spec >Macaulay2-common.spec
	(cd files-common && find . -type d -o -type f -o -type l) | sed $(SEDOPTS) >>Macaulay2-common.spec
	@FAKEROOT@ rpmbuild -bb Macaulay2-common.spec
tidy : ; rm -rf files files-common Macaulay2.spec Macaulay2-common.spec
clean :: tidy; rm -f ../../@PKG_RPM@ ../../@PKG_COM_RPM@
distclean : clean; rm -f Makefile Macaulay2-body.spec Macaulay2-common-body.spec
Makefile : Makefile.in; cd ../..; ./config.status distributions/rpm/Makefile
Macaulay2-body.spec : Macaulay2-body.spec.in; cd ../..; ./config.status distributions/rpm/Macaulay2-body.spec
Macaulay2-common-body.spec : Macaulay2-common-body.spec.in; cd ../..; ./config.status distributions/rpm/Macaulay2-common-body.spec

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/distributions/rpm "
# End:

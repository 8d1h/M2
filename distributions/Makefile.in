# @configure_input@
include ../include/config.Makefile
VPATH = @srcdir@
.PHONY : always
always :

# binary package file names
PKG_TGZ = @package@-@ARCH@-@OS@.tar.gz
PKG_TBZ = @package@-@ARCH@-@OS@.tar.bz2
PKG_TZ = @package@-@ARCH@-@OS@.tar.@COMPRESS@
PKG_COM_TGZ = @package@-common.tar.gz
PKG_COM_TBZ = @package@-common.tar.bz2
PKG_COM_TZ = @package@-common.tar.@COMPRESS@
# source package file names
SRC_TGZ = @package@.tar.gz
SRC_TBZ = @package@.tar.bz2
SRC_TZ = @package@.tar.@COMPRESS@
# package filename list generators
exclude = egrep -v '/\.nfs|/Macaulay2-[^/]*-data$$'
files_arch = (cd $(prefix) && ( \
		find @package@ -type f | egrep -v '^@package@/@datadirtail@($$|/)' && \
		find @package@/@mandirtail@ -type f )) | $(exclude)
files_comm = (cd $(prefix) && ( \
		find @package@/@datadirtail@ -type f | egrep -v '^@package@/@mandirtail@($$|/)' )) | $(exclude)
tarballs     : tarballs.@COMPRESS@
tarballs.bz2 : ../$(PKG_TBZ) ../$(PKG_COM_TBZ)
tarballs.gz  : ../$(PKG_TGZ) ../$(PKG_COM_TGZ)
TARCMD = tar --create \
	--file=$@ \
	--no-recursion \
	--owner=0 --group=0 --mode=a+rX,og-w \
	-C $(prefix) --files-from=-
../$(PKG_TBZ)     : always ; $(files_arch) | $(TARCMD) --bzip2
../$(PKG_TGZ)     : always ; $(files_arch) | $(TARCMD) --gzip
../$(PKG_COM_TBZ) : always ; $(files_comm) | $(TARCMD) --bzip2
../$(PKG_COM_TGZ) : always ; $(files_comm) | $(TARCMD) --gzip

src-files : src-files ; svn ls -R @srcdir@ | egrep -v '/$$' | sed 's=^=@package@/=' <$< >$@
@package@ : GNUmakefile ; rm -f $@ && ln -sf @srcdir@ $@
mkrt : src-files @package@
ifneq (@FAKEROOT@,)
	cat src-files | @FAKEROOT@ xargs chown root.root
endif
$(SRC_TGZ) : mkrt ; @FAKEROOT@ tar cfz $@ --files-from=src-files
$(SRC_TBZ) : mkrt ; @FAKEROOT@ tar cfj $@ --files-from=src-files
src : $(SRC_TZ)

ifeq "@M2TARFILE@" "yes"
install :: tarballs
endif
clean ::; rm -f ../$(PKG_TGZ) ../$(PKG_TBZ)

ifeq "@DEBIAN@" "yes"
install :: debian
endif
debian : ../$(PKG_TGZ) ; $(MAKE) -C debian install
check clean distclean :: ; $(MAKE) -C debian $@

ifeq "@RPM@" "yes"
install :: rpm
endif
rpm : ../$(PKG_TGZ) ; $(MAKE) -C rpm install
clean distclean :: ; $(MAKE) -C rpm $@

ifeq "@CYGWIN@" "yes"
install :: cygwin
endif
cygwin : ../$(PKG_TGZ) ; $(MAKE) -C cygwin install
clean distclean :: ; $(MAKE) -C cygwin $@
Makefile : Makefile.in; cd ..; ./config.status distributions/Makefile

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/distributions "
# End:

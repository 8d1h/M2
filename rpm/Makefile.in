# @configure_input@
include ../include/config.Makefile
VPATH = @srcdir@
DEPENDS = yes
finalprefix=@FINALPREFIX@
prefixtail=$(shell basename $(finalprefix))
prefixdir=$(shell dirname $(finalprefix))

# notice that fakeroot is required, get it here: http://ftp.debian.org/debian/pool/main/f/fakeroot

# commands for testing the rpm file:
#  install:
#    rpm -i -v --nodeps *.rpm
#  remove:
#	Version: 0.9.95
#	Release: 2
#    rpm -e -v --noscripts Macaulay2-0.9.95-2

############################## main targets
all install :: ../@PKG_RPM@
../@PKG_RPM@ : Macaulay2-body.spec ../@PKG_TGZ@ Makefile
	rm -rf files
	mkdir files
	@MKDIR_P@ files$(prefixdir)
	tar xzf ../@PKG_TGZ@ -C files$(prefixdir)
	mv files$(prefixdir)/@package@ files$(prefixdir)/$(prefixtail)
	cd files$(finalprefix) && rm -f INSTALL encapinfo postinstall preremove
	cat Macaulay2-body.spec >Macaulay2.spec
	(cd files && find ./$(finalprefix) -type f) | sed -e 's=^./="=' -e 's=$$="=' >>Macaulay2.spec
	@FAKEROOT@ chown -R root files/*
	@FAKEROOT@ rpmbuild -bb Macaulay2.spec
	rm -rf files
try-alien : ../@PKG_DEB@ ; @FAKEROOT@ alien --generate --scripts --to-rpm $^
clean ::
distclean : clean; rm -f Makefile
Makefile : Makefile.in; cd ..; ./config.status rpm/Makefile
Macaulay2-body.spec : Macaulay2-body.spec.in; cd ..; ./config.status rpm/Macaulay2-body.spec

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/rpm "
# End:

diff -ur --exclude=configure tmp/gmp-4.2.2/acinclude.m4 gmp-4.2.2/acinclude.m4
--- tmp/gmp-4.2.2/acinclude.m4	2007-09-01 06:09:03.000000000 -0400
+++ gmp-4.2.2/acinclude.m4	2008-01-06 19:54:37.000000000 -0500
@@ -3548,7 +3548,7 @@
 dnl  Check whether gmp.h recognises the compiler as ANSI capable.
 
 AC_DEFUN([GMP_H_ANSI],
-[AC_REQUIRE([AC_PROG_CC_STDC])
+[AC_REQUIRE([AC_PROG_CC_C89])
 case $ac_cv_prog_cc_stdc in
   no)
     ;;
diff -ur --exclude=configure tmp/gmp-4.2.2/configure.in gmp-4.2.2/configure.in
--- tmp/gmp-4.2.2/configure.in	2007-09-09 12:39:14.000000000 -0400
+++ gmp-4.2.2/configure.in	2008-01-06 19:54:37.000000000 -0500
@@ -1889,7 +1889,7 @@
 
 # The C compiler and preprocessor, put into ANSI mode if possible.
 AC_PROG_CC
-AC_PROG_CC_STDC
+AC_PROG_CC_C89
 AC_PROG_CPP
 GMP_H_ANSI
 
diff -ur --exclude=configure tmp/gmp-4.2.2/gmp-impl.h gmp-4.2.2/gmp-impl.h
--- tmp/gmp-4.2.2/gmp-impl.h	2007-08-30 14:31:40.000000000 -0400
+++ gmp-4.2.2/gmp-impl.h	2008-01-06 19:54:37.000000000 -0500
@@ -664,6 +664,8 @@
    but current gcc (3.0) doesn't seem to support that.  */
 __GMP_DECLSPEC extern void * (*__gmp_allocate_func) __GMP_PROTO ((size_t));
 __GMP_DECLSPEC extern void * (*__gmp_reallocate_func) __GMP_PROTO ((void *, size_t, size_t));
+__GMP_DECLSPEC extern void * (*__gmp_allocate_atomic_func) __GMP_PROTO ((size_t));
+__GMP_DECLSPEC extern void * (*__gmp_reallocate_atomic_func) __GMP_PROTO ((void *, size_t, size_t));
 __GMP_DECLSPEC extern void   (*__gmp_free_func) __GMP_PROTO ((void *, size_t));
 
 void *__gmp_default_allocate _PROTO ((size_t));
@@ -672,13 +674,18 @@
 
 #define __GMP_ALLOCATE_FUNC_TYPE(n,type) \
   ((type *) (*__gmp_allocate_func) ((n) * sizeof (type)))
-#define __GMP_ALLOCATE_FUNC_LIMBS(n)   __GMP_ALLOCATE_FUNC_TYPE (n, mp_limb_t)
+#define __GMP_ALLOCATE_ATOMIC_FUNC_TYPE(n,type) \
+  ((type *) (*__gmp_allocate_atomic_func) ((n) * sizeof (type)))
+#define __GMP_ALLOCATE_FUNC_LIMBS(n)   __GMP_ALLOCATE_ATOMIC_FUNC_TYPE (n, mp_limb_t)
 
 #define __GMP_REALLOCATE_FUNC_TYPE(p, old_size, new_size, type) \
   ((type *) (*__gmp_reallocate_func)                            \
    (p, (old_size) * sizeof (type), (new_size) * sizeof (type)))
+#define __GMP_REALLOCATE_ATOMIC_FUNC_TYPE(p, old_size, new_size, type) \
+  ((type *) (*__gmp_reallocate_atomic_func)                            \
+   (p, (old_size) * sizeof (type), (new_size) * sizeof (type)))
 #define __GMP_REALLOCATE_FUNC_LIMBS(p, old_size, new_size) \
-  __GMP_REALLOCATE_FUNC_TYPE(p, old_size, new_size, mp_limb_t)
+  __GMP_REALLOCATE_ATOMIC_FUNC_TYPE(p, old_size, new_size, mp_limb_t)
 
 #define __GMP_FREE_FUNC_TYPE(p,n,type) (*__gmp_free_func) (p, (n) * sizeof (type))
 #define __GMP_FREE_FUNC_LIMBS(p,n)     __GMP_FREE_FUNC_TYPE (p, n, mp_limb_t)
diff -ur --exclude=configure tmp/gmp-4.2.2/memory.c gmp-4.2.2/memory.c
--- tmp/gmp-4.2.2/memory.c	2007-08-30 14:31:40.000000000 -0400
+++ gmp-4.2.2/memory.c	2008-01-06 19:54:37.000000000 -0500
@@ -25,8 +25,11 @@
 
 
 void *	(*__gmp_allocate_func) _PROTO ((size_t)) = __gmp_default_allocate;
+void *	(*__gmp_allocate_atomic_func) _PROTO ((size_t)) = __gmp_default_allocate;
 void *	(*__gmp_reallocate_func) _PROTO ((void *, size_t, size_t))
      = __gmp_default_reallocate;
+void *	(*__gmp_reallocate_atomic_func) _PROTO ((void *, size_t, size_t))
+     = __gmp_default_reallocate;
 void	(*__gmp_free_func) _PROTO ((void *, size_t)) = __gmp_default_free;
 
 
